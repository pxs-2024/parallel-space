# 平行空间（Parallel Space）— 产品文档（MVP）

## 1. 产品定位

**平行空间**是一款以「规则驱动的个人资产管理」为核心的工具，用一个可视化画布把现实世界中的**物品 / 抽象资产**与**未来需要做的决策**连接起来。

> 核心价值：**让“我拥有的东西”，在需要我决策之前提醒我。**

## 2. 目标用户

- 注重秩序与可控性的个人用户
- 有较多实体 / 虚拟资产需要管理的人
- 技术背景用户（工程师 / 设计师 / 自由职业者）

## 3. 核心概念

### 3.1 Space（空间）

- MVP 中**空间**即管理作用域：所有资产（Asset）与行为（Action）都挂在 Space 下，归属当前用户。
- 用户可创建多个空间（如「书房」「厨房」），每个空间在**平面图**上对应一块格点区域，并拥有该空间内的物品列表。
- 侧栏入口为**物品管理**，进入后为**平面图画布**（格点绘制空间形状）；无嵌套（Space 下不再挂子 Space）。
- 点击某空间区域滑出**底部抽屉**，展示该空间物品列表与详情；右侧可打开**全局物品搜索**（筛选、分页、跳转空间）。编辑模式下可右键空间「编辑空间」「编辑信息」或「删除空间」（删除时一并删除该空间内物品，有确认）。

### 3.2 Asset（资产 / 物品）

**定义**：需要被记住、并可能触发决策的现实存在。

**类型（Kind）**

- `STATIC`：静态（书籍、设备等）
- `CONSUMABLE`：消耗型（洗发水、文具等，支持数量、单位、补货点、周期消耗）
- `TEMPORAL`：时间型（滤芯更换、保养等，支持 dueAt / nextDueAt）

**状态（State）**

- `ACTIVE`：在用
- `PENDING`：待处理（如待补充）
- `PAUSED`：暂停（不触发提醒）
- `DISCARDED`：已废弃

**能力字段（按类型）**

- 消耗型：数量（quantity + unit）、补货点（reorderPoint）、消耗周期（consumeIntervalDays / consumeAmountPerTime）
- 时间型：dueAt、lastDoneAt、nextDueAt
- 通用：软删除标记 isDeleted；名称、描述

物品归属某一空间；在空间抽屉内以卡片列表展示，点击打开详情编辑，右键可「移入其他空间」或「删除物品」（硬删除，含确认，并删除关联 Action）。

### 3.3 物品管理页与抽屉

- **物品管理**页：主区域为平面图画布（格点空间），编辑模式下可框选绘制/修改空间、使用模版、生成图形、右键编辑信息或删除空间。
- **底部抽屉**：点击空间后滑出，为该空间物品卡片列表；支持新建物品、点击卡片打开详情、右键「移入其他空间」或「删除物品」。
- **全局搜索**：右侧悬浮入口，打开后面板支持筛选、分页、跳转空间。

## 4. 规则与行为（Rules → Action）

### 4.1 设计原则

- 规则以代码实现、基于资产类型与字段，非用户可配置的表达式。
- 规则只负责**生成待处理 Action**，不自动改资产；用户是最终决策者。

### 4.2 MVP 已实现规则

1. **消耗型补货提醒**：数量 ≤ reorderPoint 时生成 `RESTOCK` 类 Action，待办页可补充数量并完成。
2. **时间型到期/即将到期**：TEMPORAL 的 nextDueAt 已过或临近时生成待办，用户可选择新的到期时间并更新。
3. **待丢弃**：消耗型数量为 0 时生成待办，由用户确认丢弃或忽略。
4. **新增物品（AI 建议）**：用户在「AI建议」页获取推荐、采纳后生成 `NEW_ASSET` 类 Action；待办页选择目标空间后在该空间创建物品并关闭 Action。

未在 MVP 中实现：自动消耗记录、虚拟型、定期检查（CHECK）等，预留扩展。

### 4.3 Action 类型与状态

- **类型**：`RESTOCK`（补货）、`NEW_ASSET`（新增物品，来自 AI 建议采纳）。
- **状态**：`OPEN`（待处理）、`DONE`（已完成）。Action 与 Asset 关联时，删除 Asset 会级联删除其 Action。

## 5. 行动中心（待办页）

### 5.1 行为定义

- Action 为规则触发后的**待处理决策**，用户可「补充数量」「选择到期时间」「确认丢弃」「忽略（一天/一周/一月）」或对 NEW_ASSET 类「选择目标空间并完成」。
- 不自动执行；用户手动确认后更新 Asset 或创建 Asset，并关闭 Action，操作后有 Toast 提示。

### 5.2 MVP 实现

- **待办页**：展示 OPEN 状态的 RESTOCK、NEW_ASSET 等，支持搜索、按类型/时间筛选（nuqs 同步 URL）、批量忽略；处理后在列表中移除或刷新。

## 6. 平面图与抽屉

### 6.1 设计目标

- 空间以平面图格点区域呈现，认知空间的可视化，非物理仿真；物品在抽屉内以列表展示，不做画布坐标持久化。

### 6.2 MVP 交互

- **平面图画布**：格点绘制空间形状，支持 Pan / Zoom；编辑模式下框选、模版、生成图形，右键空间可编辑形状/信息或删除空间（确认后一并删除该空间内物品）。
- **底部抽屉**：点击空间后滑出，为该空间物品卡片列表；新建物品、点击卡片打开详情编辑、右键「移入其他空间」或「删除物品」（确认后硬删除并删除关联 Action）。无物品画布拖拽与保存布局。
- **全局搜索**：右侧悬浮入口，打开后面板支持筛选、分页、跳转空间。

### 6.3 技术实现

- 平面图：Canvas / DOM + 格点坐标，空间形状以 cells（格点数组）存储；编辑态与完成提交逻辑在前端与 API 中实现。

## 7. AI 建议（AI Suggestions）

- **入口**：侧栏「AI建议」。
- **按空间推荐清单**：页面展示按空间划分的基础生活物品清单（入口、客厅、厨房等），供参考。
- **获取建议**：根据用户现有空间与物品计算缺口，按空间逐条展示推荐补充项；用户可「采纳」加入待办（NEW_ASSET）或「忽略」，采纳项在待办页选择目标空间后完成创建。

## 8. 权限与多人（非 MVP）

- **当前**：单人；所有 Space / Asset / Action 归属当前用户。
- **未来**：Space → Workspace、Membership、轻实时同步等，当前不实现。

## 9. 技术栈（MVP）

- **Next.js**（App Router）、**TypeScript**
- **Tailwind CSS 4 + shadcn/ui**（含 Calendar、Popover、Dialog、Context Menu 等）
- **Prisma + PostgreSQL**（engineType client + @prisma/adapter-pg，适合 Serverless）
- **自定义 Session + Argon2**（@node-rs/argon2）实现账号密码登录
- **next-intl**（国际化）、**nuqs**（URL 状态）、**next-themes**（主题）
- **sonner**（Toast）、**date-fns + react-day-picker**（日期选择）

## 10. 种子数据（Seed）

- 用户、平面图空间（格点 cells 定义形状）、静态/消耗型/时间型物品、OPEN 待办（RESTOCK、NEW_ASSET）等，便于测试。

## 11. MVP 完成标准（与当前实现对齐）

- [x] 用户可注册 / 登录（Session + Argon2）
- [x] 物品管理页：平面图画布（编辑/模版/生成图形、右键编辑信息与删除空间）、点击空间打开物品抽屉
- [x] 空间物品抽屉：物品卡片列表、新建物品、点击打开详情编辑、右键移入其他空间/删除物品（确认、硬删除）
- [x] Asset 具备规则所需字段（补货点、周期消耗、到期等），规则生成 RESTOCK / NEW_ASSET 等 Action
- [x] 待办页可处理 Action（补货、到期、丢弃、新增物品选空间等），含 Toast、日历选择
- [x] AI 建议页：按空间推荐清单、获取建议、采纳/忽略并进入待办
- [x] 全局搜索：筛选、分页、跳转空间

## 12. 未来计划

- **新手操作说明**：首次进入或关键页面提供简短引导（如平面图编辑、待办处理、AI 建议流程），支持跳过与再次查看，降低上手成本。
- **AI 付费计划**：对「获取 AI 建议」等依赖外部模型调用的能力，规划免费额度与付费档位（按次/按月等），在应用内展示用量与升级入口，并遵守隐私与数据合规。

---

（本产品文档与当前代码实现对齐，可在不破坏模型的前提下持续演进。）

┌──────────────────────────────┐
│           React UI           │
│  ─ 按钮                      │
│  ─ 侧边栏                    │
│  ─ Canvas DOM                │
└──────────────┬───────────────┘
               │
               ▼
┌──────────────────────────────┐
│       FloorPlanEngine        │
│  (系统总控制器 / 大脑)        │
│                              │
│  - 当前工具 Tool             │
│  - 当前交互状态 DragState     │
│  - History                   │
│  - Store                     │
└──────────────┬───────────────┘
               │
               ▼
        ┌───────────────┐
        │   Tool        │  ← Strategy 模式
        │ (选择交互策略) │
        └───────┬───────┘
                │
                ▼
        ┌───────────────┐
        │  DragState    │  ← State 模式
        │ (处理拖拽过程) │
        └───────┬───────┘
                │ 产生
                ▼
        ┌───────────────┐
        │   Command     │  ← 唯一允许修改数据
        │ (执行/撤销)    │
        └───────┬───────┘
                │ 修改
                ▼
        ┌───────────────┐
        │    Store      │  ← Observer
        │ (保存状态)     │
        └───────┬───────┘
                │ 通知
                ▼
        ┌───────────────┐
        │  Renderer     │
        │ (rAF 合帧绘制) │
        └───────────────┘
鼠标按下
   ↓
Tool 决定进入 BoxSelectState
   ↓
拖动
   ↓
BoxSelectState 更新 overlay
   ↓
松开
   ↓
产生 ApplySelectionCommand
   ↓
Command 修改 Store
   ↓
Store 通知 Renderer
   ↓
下一帧绘制



┌──────────────────────────────┐
│ UI 层                        │
│ React                        │
│ 只负责界面                   │
└──────────────────────────────┘

┌──────────────────────────────┐
│ Engine 层                    │
│ 交互控制逻辑                 │
│ 工具管理                     │
│ 状态机管理                   │
│ 历史管理                     │
└──────────────────────────────┘

┌──────────────────────────────┐
│ Domain 层                    │
│ Space / Cell 数据结构        │
│ 命中规则                     │
│ 选择算法                     │
└──────────────────────────────┘

┌──────────────────────────────┐
│ 渲染层                        │
│ draw(ctx, state)             │
│ 纯绘制                       │
└──────────────────────────────┘
